=== GITHUB PUSH ===
git add .
git commit -m "Production ready with PostgreSQL, admin features, and security"
git push origin main

=== BUILD ON LOCAL PC (RECOMMENDED) ===
# On Windows PC:
$env:NODE_OPTIONS="--max-old-space-size=8192"
npm run build

# Then deploy .next folder to VPS via SCP or Git

=== VPS DEPLOYMENT (IF BUILD WORKS) ===
cd ~/apps/darkbyte-dashboard
git pull origin main
npm install
npx prisma generate
npx prisma migrate deploy
NODE_OPTIONS="--max-old-space-size=8192" npm run build
pm2 delete all
pm2 start npm --name "dashboard" -- start
pm2 save

=== VPS DEPLOYMENT (DEV MODE - IF BUILD FAILS) ===
cd ~/apps/darkbyte-dashboard
git pull origin main
npm install
npx prisma generate
npx prisma migrate deploy
pm2 delete all
pm2 start "npm run dev" --name "dashboard"
pm2 save
pm2 logs dashboard

=== FIRST TIME VPS SETUP ===
# Install dependencies
sudo apt update && sudo apt upgrade -y
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs postgresql nginx
sudo npm install -g pm2

# PostgreSQL setup
sudo -u postgres psql -c "CREATE DATABASE darkbyte;"
sudo -u postgres psql -c "CREATE USER dbuser WITH PASSWORD 'password123';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE darkbyte TO dbuser;"

# Clone repo
cd /var/www
git clone YOUR_GITHUB_REPO app
cd app
cp .env.example .env
nano .env  # Edit with production values
npm install
npx prisma generate
npx prisma migrate deploy
npm run build
pm2 start npm --name "dashboard" -- start
pm2 startup
pm2 save

# Nginx config
sudo nano /etc/nginx/sites-available/default
# Add:
# server {
#   listen 80;
#   server_name yourdomain.com;
#   location / {
#     proxy_pass http://localhost:3000;
#     proxy_http_version 1.1;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection 'upgrade';
#     proxy_set_header Host $host;
#     proxy_cache_bypass $http_upgrade;
#   }
# }
sudo nginx -t
sudo systemctl restart nginx

=== UPDATE ON VPS ===
cd /var/www/app
git pull
npm install
npx prisma migrate deploy
npm run build
pm2 restart dashboard
